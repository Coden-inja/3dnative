<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>360 Player</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <style>
      /* --- 1. OVERLAYS & UI --- */
      body { margin: 0; overflow: hidden; font-family: sans-serif; }

      /* Start Screen */
      #overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 9999;
        display: flex; justify-content: center; align-items: center;
        cursor: pointer;
      }
      #play-btn {
        padding: 15px 30px; font-size: 18px; background: white;
        border: none; border-radius: 4px; font-weight: bold;
        text-transform: uppercase; letter-spacing: 1px; cursor: pointer;
      }

      /* Top Left Header */
      #ui-header {
        position: fixed; top: 20px; left: 20px; z-index: 100;
        color: white; pointer-events: none;
        text-shadow: 1px 1px 4px rgba(0,0,0,0.8);
      }
      h1 { margin: 0; font-size: 1.2rem; letter-spacing: 1px; }
      p { margin: 5px 0 0 0; font-size: 0.8rem; opacity: 0.8; }

      /* Play/Pause Center Icon */
      #status-indicator {
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        z-index: 90; pointer-events: none; display: none;
      }
      .pause-icon {
        width: 0; height: 0;
        border-top: 20px solid transparent;
        border-bottom: 20px solid transparent;
        border-left: 35px solid rgba(255,255,255,0.8);
      }

      /* --- CUSTOM FULLSCREEN BUTTON --- */
      #fullscreen-btn {
        position: fixed; bottom: 20px; right: 20px; z-index: 100;
        background: rgba(0, 0, 0, 0.5); color: white;
        border: 2px solid white; border-radius: 5px;
        width: 40px; height: 40px;
        display: flex; justify-content: center; align-items: center;
        cursor: pointer; transition: background 0.2s;
      }
      #fullscreen-btn:hover { background: rgba(255, 255, 255, 0.2); }
      
      /* SVG Icon styling */
      #fullscreen-btn svg { width: 20px; height: 20px; fill: white; }

    </style>
  </head>
  <body>

    <div id="overlay">
      <button id="play-btn">START TOUR</button>
    </div>

    <div id="ui-header">
      <h1>REAL ESTATE</h1>
      <p>Luxury Apartment • 4K 360°</p>
    </div>

    <div id="status-indicator">
      <div class="pause-icon"></div>
    </div>

    <div id="fullscreen-btn" title="Toggle Fullscreen">
      <svg viewBox="0 0 24 24">
        <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
      </svg>
    </div>

    <a-scene loading-screen="dotsColor: white; backgroundColor: black"
             vr-mode-ui="enabled: false">
      
      <a-assets>
        <video id="video360" 
               src="video.mp4"
               loop="true" 
               crossorigin="anonymous" 
               playsinline 
               webkit-playsinline>
        </video>
      </a-assets>

      <a-videosphere src="#video360" rotation="0 -90 0"></a-videosphere>

      <a-entity camera look-controls="reverseMouseDrag: true"></a-entity>
    </a-scene>

    <script>
      const overlay = document.querySelector('#overlay');
      const video = document.querySelector('#video360');
      const scene = document.querySelector('a-scene');
      const statusIndicator = document.querySelector('#status-indicator');
      const fsBtn = document.querySelector('#fullscreen-btn');

      let isPlaying = false;

      // 1. IOS GYRO PERMISSIONS
      function requestMotionPermission() {
        if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
          DeviceMotionEvent.requestPermission().catch(console.error);
        }
      }

      // 2. START LOGIC
      overlay.addEventListener('click', function () {
        overlay.style.display = 'none';
        video.play();
        isPlaying = true;
        requestMotionPermission();
      });

      // 3. PLAY/PAUSE LOGIC (With Drag Detection)
      let mouseDownTime = 0;
      scene.addEventListener('mousedown', () => { mouseDownTime = Date.now(); });
      scene.addEventListener('touchstart', () => { mouseDownTime = Date.now(); });

      const handleInteractionEnd = () => {
        const timeDiff = Date.now() - mouseDownTime;
        if (timeDiff < 500) { togglePlayPause(); }
      };

      scene.addEventListener('mouseup', handleInteractionEnd);
      scene.addEventListener('touchend', handleInteractionEnd);

      function togglePlayPause() {
        if (video.paused) {
          video.play();
          statusIndicator.style.display = 'none';
        } else {
          video.pause();
          statusIndicator.style.display = 'block';
        }
      }

      // 4. FULLSCREEN LOGIC
      fsBtn.addEventListener('click', function(e) {
        e.stopPropagation(); // Prevent triggering play/pause underneath
        
        if (!document.fullscreenElement) {
          // Enter Fullscreen
          if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
          } else if (document.documentElement.webkitRequestFullscreen) { /* Safari */
            document.documentElement.webkitRequestFullscreen();
          } else if (document.documentElement.msRequestFullscreen) { /* IE11 */
            document.documentElement.msRequestFullscreen();
          }
        } else {
          // Exit Fullscreen
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) { /* Safari */
            document.webkitExitFullscreen();
          } else if (document.msExitFullscreen) { /* IE11 */
            document.msExitFullscreen();
          }
        }
      });
    </script>
  </body>
</html>