<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>360 Player - SystemStar POC</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <style>
      /* 2. OVERLAY STYLING: Covers the screen to force a click */
      #overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.85); z-index: 9999;
        display: flex; justify-content: center; align-items: center;
        cursor: pointer;
      }
      #play-btn {
        padding: 20px 40px; font-size: 18px; background: white;
        border: none; border-radius: 5px; font-weight: bold;
        text-transform: uppercase;
      }
    </style>
  </head>
  <body>

    <div id="overlay">
      <button id="play-btn">Click to Start Experience</button>
    </div>

    <a-scene loading-screen="dotsColor: white; backgroundColor: black">
      
      <a-assets>
        <video id="video360" 
               src="demoVideo.mp4"
               loop="true" 
               crossorigin="anonymous" 
               playsinline 
               webkit-playsinline>
        </video>
      </a-assets>

      <a-videosphere src="#video360" rotation="0 -90 0"></a-videosphere>

      <a-entity camera look-controls="reverseMouseDrag: true"></a-entity>

    </a-scene>

    <script>
      const overlay = document.querySelector('#overlay');
      const video = document.querySelector('#video360');

      // 7. THE CRITICAL IOS PERMISSION FUNCTION
      function requestMotionPermission() {
        // Check if the browser supports DeviceMotionEvent and requires permission (iOS 13+)
        if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
          
          DeviceMotionEvent.requestPermission()
            .then(response => {
              if (response === 'granted') {
                console.log('Gyro permission granted');
              } else {
                console.warn('Gyro permission denied');
              }
            })
            .catch(console.error);
        }
      }

      // 8. EVENT LISTENER: Runs when user clicks "Start"
      overlay.addEventListener('click', function () {
        // Hide the overlay
        overlay.style.display = 'none';
        
        // Play the video (Unlocks the AudioContext and Video Autoplay block)
        video.play();
        
        // Ask iOS for permission to use the Gyroscope
        requestMotionPermission();
      });
    </script>
  </body>
</html>